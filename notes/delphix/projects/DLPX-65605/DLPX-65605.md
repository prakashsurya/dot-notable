---
title: delphix/projects/DLPX-65605
created: '1970-01-01T00:00:00.000Z'
modified: '2019-09-19T16:53:46.660Z'
---

# DLPX-65605 Timeout waiting for zvol link to be created

* https://jira.delphix.com/browse/DLPX-65605

## Next

1. Write script to generate wall clock flamegraphs
2. Write script to measure taskq throughput

## Synopsis

According to John as pointed out in the bug, the issue appears to be a
combination of the following factors:

1. The function used to remove ZVOLs can take a relatively long time to
   remove a single ZVOL.
2. Each ZVOL is removed in a single threaded manner.
3. Each ZVOL is created in a single threaded manner.
4. A relatively large bach of ZVOL removals (prior to a ZVOL create) can
   significantly impact ZVOL creation latency due to the 3 points above.

## Notes

* Scalability system used to reproduce issue:
  * http://scale-dlpx-trunk-l100ms-2.scale-dc.delphix.com

## Log

### 2019.9.19

It took awhile, but this issue did reproduce on the scalability system.
Now we have a systemt that'll repdocue the issue, we need to use it to
answer the following questions:

1. What is the current throughput?
   * Create new BPF script to measure

2. Why is the throughput what it is?
   * Create new flamegraphs for on-cpu and off-cpu

3. What do we need the throughput to be?
   * Determine max number of VDBs
   * Determine number of ZVOLs per VDB
   * Determine max VDB refresh rate
   * Determine the product of above values

### 2019.9.18

With help from Kevin, we've regenerated the DE (again) and bumped the
number of VDBs to 400, and are waiting to see if it'll reproduce with
more VDBs.

### 2019.9.17

I haven't been able to reproduce the error on the original DE where the
issue was previously occuring. With that said, this original DE has been
regenerated since we last saw the issue, so the version of the software
that's currently running on the system isn't exactly the same software
that was previously running (e.g. both zfs and the kernel versions have
changed).

With about 110 VDBs running on this system, set to a refresh interval of
15 minutes each, the issue has not cropped up yet.
